State of the Agent: Kalynt v1.x Status & Remaining Path to ParityDate: February 6, 2026Subject: Architectural Gap Analysis & Final Implementation RoadmapTarget: Feature Parity with Cursor IDE via Local 7B Models1. Executive Summary: From "Brain in a Vat" to "Blindfolded Speedster"Significant progress has been made in transforming Kalynt from a reactive text-processor into an environment-aware agent. The "Brain in a Vat" critiqueâ€”that the agent was isolated from the codebase structure and workflowâ€”has been largely addressed.The Agent now has Eyes: With the implementation of the Repository Map, the agent can "see" the entire project structure, eliminating the "tunnel vision" that caused hallucinated imports.The Agent now has a Brain: The Architect/Editor ReAct loop successfully splits reasoning from execution, preventing the "attention dispersion" common in 7B models.The Agent now has Hands: The introduction of Fuzzy Replace (Levenshtein matching) allows it to modify files even when it hallucinates minor whitespace differences.The Remaining Problem: The agent is still "reckless." It writes code but never verifies if it compiles (The Validation Gap). It is also "slow" at applying large changes because it relies on standard inference rather than speculative decoding (The Speed Gap).2. Current Architecture StatusArchitecture ComponentStatusAnalysisContext AwarenessðŸŸ¢ RESOLVEDRepo Map implemented. The agent generates and reads a structural map of the codebase (AST-based), allowing it to understand dependencies without opening every file.Workflow LogicðŸŸ¢ RESOLVEDReAct Loop & Architect/Editor Split active. Complex tasks are correctly decomposed into a plan (Architect) before code is generated (Editor).Code ApplicationðŸŸ¡ PARTIALFuzzy Replace handles minor diff errors, but "Whole File" rewritesâ€”the gold standard for reliabilityâ€”are too slow without Speculative Decoding.Tool ReliabilityðŸ”´ CRITICALJSON Protocol causes syntax errors in 7B models. Needs migration to XML.ValidationðŸ”´ MISSINGNo Shadow Workspace. The agent assumes its edits work. It lacks the "Reflexes" to see linter errors immediately after writing.3. Critical Implementation RoadmapTo achieve true parity with Cursor, the following three phases must be executed in this specific order to maximize stability and speed.Phase 1: The Protocol Shift (Immediate Win)Objective: Eliminate tool-call syntax errors (JSON parse error) and improve adherence to instructions.The Problem: 7B models struggle to escape nested quotes in JSON (e.g., writing Python code inside a JSON string inside a JSON tool call).The Solution: Switch ideAgentTools.ts and agentService.ts prompts to use an XML Protocol.Implementation:XML<tool_code>
    <name>write_file</name>
    <path>src/main.ts</path>
    <content>
        console.log("No escaping needed!");
    </content>
</tool_code>
Evidence: Local model benchmarks (Aider/Cline) show XML tags reduce syntax errors by ~30-50% for 7B models.Phase 2: The Speed Upgrade (Speculative Decoding)Objective: Enable "Whole File" rewrites at 100+ tokens/second, making the "Editor" mode feel instant.The Problem: Rewriting a 500-line file with a 7B model at 40 t/s takes ~12 seconds. This latency forces us to use brittle "diffs" or "fuzzy replace."The Solution: Implement Speculative Decoding in llm-inference.ts.Implementation:Load Qwen 2.5 0.5B (Draft Model) alongside the 7B Target.Pass the draft model handle to the node-llama-cpp context.The Draft Model "sketches" the unchanged lines instantly; the 7B model verifies them in parallel.Impact: "Whole File" rewrites become 3-4x faster, allowing us to abandon complex diff logic entirely.Phase 3: The Safety Net (Shadow Workspace)Objective: The Agent never breaks the user's build.The Problem: The agent writes code that looks correct but fails to compile. It doesn't know this until the user complains.The Solution: A hidden verification loop.Implementation:Hidden Window: Spawn a headless Electron BrowserWindow in main.ts.CRDT Forking: In collabEngine.ts, create a "Shadow Peer" that receives Agent edits.LSP Bridge: The Shadow Window runs the Language Server. If it reports diagnostics (red squiggles), these are fed back to the Agent as a new prompt: "Your code caused error X on line Y. Fix it."Merge: Only merge the Shadow Peer's changes to the Main Peer when diagnostics are clear.